<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dumuria Govt. Technical School - Result System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .hidden { display: none; }
        @media print {
            body * { visibility: hidden; }
            #pdfContent, #pdfContent * { visibility: visible; }
            #pdfContent { position: absolute; left: 0; top: 0; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">

    <!-- Loading Screen -->
    <div id="loadingScreen" class="flex items-center justify-center min-h-screen">
        <div class="text-3xl text-blue-600 font-bold">Loading...</div>
    </div>

    <!-- Home Page -->
    <div id="homePage" class="hidden container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h1 class="text-4xl font-bold text-center text-blue-900 mb-2">
                üéì Dumuria Government Technical School & College
            </h1>
            <p class="text-center text-gray-600">Student Result Management System</p>
        </div>

        <!-- Admin Button -->
        <div class="flex justify-end mb-6">
            <button onclick="showLogin()" class="flex items-center gap-2 bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition">
                üë§ Admin Login
            </button>
        </div>

        <!-- Search Section -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">üîç Search Student Result</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <input type="text" id="searchName" placeholder="Student Name" class="border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none">
                <input type="text" id="searchRoll" placeholder="Roll Number" class="border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none">
                <select id="searchClass" class="border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none">
                    <option value="">Select Class</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                </select>
                <select id="searchBranch" class="border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none">
                    <option value="">Select Branch</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                </select>
            </div>
            <button onclick="searchStudent()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition">
                üîç Search Result
            </button>

            <div id="searchResult" class="hidden mt-6 p-4 bg-green-50 border-2 border-green-500 rounded-lg">
                <h3 class="text-xl font-bold text-green-800 mb-4">‚úÖ Result Found!</h3>
                <div id="searchResultContent" class="bg-white p-4 rounded-lg"></div>
            </div>
        </div>

        <!-- All Students -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">üìã All Students</h2>
            <div id="allStudentsList" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="hidden min-h-screen flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-lg p-8 max-w-md w-full mx-4">
            <h2 class="text-3xl font-bold text-center text-blue-900 mb-6">üîê Admin Login</h2>
            <input type="text" id="loginUsername" placeholder="Username" class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 mb-4 focus:border-blue-500 focus:outline-none">
            <input type="password" id="loginPassword" placeholder="Password" class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 mb-6 focus:border-blue-500 focus:outline-none">
            <button onclick="handleLogin()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition mb-4">
                Login
            </button>
            <button onclick="showHome()" class="w-full bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition">
                Back to Home
            </button>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPage" class="hidden container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8 flex justify-between items-center">
            <h1 class="text-3xl font-bold text-blue-900">üë®‚Äçüè´ Admin Panel</h1>
            <button onclick="handleLogout()" class="flex items-center gap-2 bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition">
                üö™ Logout
            </button>
        </div>

        <!-- Add New Student -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">‚ûï Add New Student</h2>
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-4">
                <input type="text" id="newStudentName" placeholder="Student Name" class="border-2 border-gray-300 rounded-lg px-4 py-2">
                <input type="number" id="newStudentRoll" placeholder="Roll" class="border-2 border-gray-300 rounded-lg px-4 py-2">
                <select id="newStudentClass" onchange="checkDepartment()" class="border-2 border-gray-300 rounded-lg px-4 py-2">
                    <option value="6">Class 6</option>
                    <option value="7">Class 7</option>
                    <option value="8">Class 8</option>
                    <option value="9">Class 9</option>
                    <option value="10">Class 10</option>
                </select>
                <select id="newStudentBranch" class="border-2 border-gray-300 rounded-lg px-4 py-2">
                    <option value="A">Branch A</option>
                    <option value="B">Branch B</option>
                </select>
                <select id="newStudentDepartment" class="hidden border-2 border-gray-300 rounded-lg px-4 py-2">
                    <option value="">Select Department</option>
                    <option value="Civil">Civil</option>
                    <option value="Computer">Computer</option>
                    <option value="Electrical">Electrical</option>
                    <option value="Mechanical">Mechanical</option>
                </select>
            </div>
            <button onclick="addStudent()" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition">
                ‚ûï Add Student
            </button>
        </div>

        <!-- Mark Entry -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">üìù Enter Marks by Subject</h2>
            
            <!-- Class Selection -->
            <div class="mb-6">
                <label class="block text-gray-700 font-semibold mb-2">Select Class:</label>
                <div class="flex flex-wrap gap-2">
                    <button onclick="selectClass('6')" class="px-6 py-3 rounded-lg transition bg-gray-200 text-gray-700 hover:bg-gray-300" data-class="6">Class 6</button>
                    <button onclick="selectClass('7')" class="px-6 py-3 rounded-lg transition bg-gray-200 text-gray-700 hover:bg-gray-300" data-class="7">Class 7</button>
                    <button onclick="selectClass('8')" class="px-6 py-3 rounded-lg transition bg-gray-200 text-gray-700 hover:bg-gray-300" data-class="8">Class 8</button>
                    <button onclick="selectClass('9')" class="px-6 py-3 rounded-lg transition bg-gray-200 text-gray-700 hover:bg-gray-300" data-class="9">Class 9</button>
                    <button onclick="selectClass('10')" class="px-6 py-3 rounded-lg transition bg-gray-200 text-gray-700 hover:bg-gray-300" data-class="10">Class 10</button>
                </div>
            </div>

            <!-- Subject Selection -->
            <div id="subjectSelection" class="hidden mb-6">
                <label class="block text-gray-700 font-semibold mb-2">Select Subject:</label>
                <div id="subjectButtons" class="grid grid-cols-2 md:grid-cols-3 gap-3"></div>
            </div>

            <!-- Mark Entry Table -->
            <div id="markEntryTable" class="hidden overflow-x-auto"></div>
        </div>
    </div>

    <!-- Student Detail Modal -->
    <div id="studentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-blue-900">Student Result</h2>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
            </div>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // Global Variables
        let students = [];
        let currentPage = 'loading';
        let isAdmin = false;
        let selectedClass = '';
        let selectedSubject = '';

        // Subjects Configuration
        const subjects = {
            '6': ['Bangla', 'English', 'Math', 'Science', 'Social Science', 'Religion'],
            '7': ['Bangla', 'English', 'Math', 'Science', 'Social Science', 'Religion'],
            '8': ['Bangla', 'English', 'Math', 'Science', 'Social Science', 'Religion'],
            '9-Civil': ['Bangla', 'English', 'Math', 'Science', 'Trade 1', 'Trade 2'],
            '9-Computer': ['Bangla', 'English', 'Math', 'Science', 'Computer 1', 'Computer 2'],
            '9-Electrical': ['Bangla', 'English', 'Math', 'Science', 'Electrical 1', 'Electrical 2'],
            '9-Mechanical': ['Bangla', 'English', 'Math', 'Science', 'Mechanical 1', 'Mechanical 2'],
            '10-Civil': ['Bangla', 'English', 'Math', 'Science', 'Trade 1', 'Trade 2'],
            '10-Computer': ['Bangla', 'English', 'Math', 'Science', 'Computer 1', 'Computer 2'],
            '10-Electrical': ['Bangla', 'English', 'Math', 'Science', 'Electrical 1', 'Electrical 2'],
            '10-Mechanical': ['Bangla', 'English', 'Math', 'Science', 'Mechanical 1', 'Mechanical 2']
        };

        const departments = ['Civil', 'Computer', 'Electrical', 'Mechanical'];

        // Initialize
        async function init() {
            try {
                const stored = await window.storage.get('students');
                if (stored) {
                    students = JSON.parse(stored.value);
                } else {
                    students = generateDemoStudents();
                    await saveStudents();
                }
            } catch (error) {
                students = generateDemoStudents();
            }
            showHome();
        }

        // Generate Demo Students
        function generateDemoStudents() {
            const names = ['Rahim Ahmed', 'Karim Hassan', 'Fatima Begum', 'Ayesha Khan', 'Habib Rahman'];
            const demo = [];
            
            for (let cls = 6; cls <= 10; cls++) {
                const branches = ['A', 'B'];
                branches.forEach(branch => {
                    for (let i = 1; i <= 3; i++) {
                        const student = {
                            id: `${cls}-${branch}-${i}`,
                            name: `${names[i % names.length]} ${cls}${branch}`,
                            roll: i,
                            class: cls.toString(),
                            branch: branch,
                            department: cls >= 9 ? departments[i % departments.length] : '',
                            marks: {}
                        };
                        
                        const subjectKey = cls >= 9 ? `${cls}-${student.department}` : cls.toString();
                        subjects[subjectKey]?.forEach(subject => {
                            student.marks[subject] = Math.floor(Math.random() * 40) + 60;
                        });
                        
                        demo.push(student);
                    }
                });
            }
            return demo;
        }

        // Save Students
        async function saveStudents() {
            try {
                await window.storage.set('students', JSON.stringify(students));
            } catch (error) {
                console.error('Save failed:', error);
            }
        }

        // Page Navigation
        function showPage(page) {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('homePage').classList.add('hidden');
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            
            if (page === 'home') {
                document.getElementById('homePage').classList.remove('hidden');
                renderAllStudents();
            } else if (page === 'login') {
                document.getElementById('loginPage').classList.remove('hidden');
            } else if (page === 'admin') {
                document.getElementById('adminPage').classList.remove('hidden');
            }
            currentPage = page;
        }

        function showHome() {
            showPage('home');
        }

        function showLogin() {
            showPage('login');
        }

        function showAdmin() {
            showPage('admin');
        }

        // Login
        function handleLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (username === 'admin' && password === 'admin') {
                isAdmin = true;
                showAdmin();
            } else {
                alert('Invalid credentials!');
            }
        }

        function handleLogout() {
            isAdmin = false;
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            showHome();
        }

        // Search Student
        function searchStudent() {
            const name = document.getElementById('searchName').value.toLowerCase();
            const roll = document.getElementById('searchRoll').value;
            const cls = document.getElementById('searchClass').value;
            const branch = document.getElementById('searchBranch').value;

            const result = students.find(s => 
                (name && s.name.toLowerCase().includes(name)) ||
                (roll && s.roll.toString() === roll) ||
                (cls && branch && s.class === cls && s.branch === branch)
            );

            const resultDiv = document.getElementById('searchResult');
            const contentDiv = document.getElementById('searchResultContent');

            if (result) {
                resultDiv.classList.remove('hidden');
                contentDiv.innerHTML = `
                    <p><strong>Name:</strong> ${result.name}</p>
                    <p><strong>Roll:</strong> ${result.roll}</p>
                    <p><strong>Class:</strong> ${result.class} | <strong>Branch:</strong> ${result.branch}</p>
                    ${result.department ? `<p><strong>Department:</strong> ${result.department}</p>` : ''}
                    <div class="mt-4">
                        <button onclick='showStudentDetail(${JSON.stringify(result)})' class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 mr-2">
                            View Full Result
                        </button>
                        <button onclick='downloadPDF(${JSON.stringify(result)})' class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                            üì• Download PDF
                        </button>
                    </div>
                `;
            } else {
                resultDiv.classList.remove('hidden');
                contentDiv.innerHTML = '<p class="text-red-600 font-semibold">‚ùå No student found!</p>';
            }
        }

        // Render All Students
        function renderAllStudents() {
            const container = document.getElementById('allStudentsList');
            container.innerHTML = students.slice(0, 20).map(student => `
                <div onclick='showStudentDetail(${JSON.stringify(student)})' class="p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:shadow-lg cursor-pointer transition">
                    <h3 class="font-bold text-lg text-blue-900">${student.name}</h3>
                    <p class="text-gray-600">Roll: ${student.roll}</p>
                    <p class="text-gray-600">Class: ${student.class} | Branch: ${student.branch}</p>
                    ${student.department ? `<p class="text-gray-600 text-sm">${student.department}</p>` : ''}
                </div>
            `).join('');
        }

        // Show Student Detail Modal
        function showStudentDetail(student) {
            const modal = document.getElementById('studentModal');
            const content = document.getElementById('modalContent');
            
            const subjectKey = student.class >= '9' ? `${student.class}-${student.department}` : student.class;
            const total = Object.values(student.marks).reduce((sum, mark) => sum + parseInt(mark || 0), 0);
            
            content.innerHTML = `
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <p class="text-lg"><strong>Name:</strong> ${student.name}</p>
                    <p><strong>Roll:</strong> ${student.roll} | <strong>Class:</strong> ${student.class} | <strong>Branch:</strong> ${student.branch}</p>
                    ${student.department ? `<p><strong>Department:</strong> ${student.department}</p>` : ''}
                </div>

                <table class="w-full border-collapse mb-4">
                    <thead>
                        <tr class="bg-blue-600 text-white">
                            <th class="border border-gray-300 p-3">Subject</th>
                            <th class="border border-gray-300 p-3">Marks</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Object.entries(student.marks).map(([subject, mark]) => `
                            <tr class="hover:bg-gray-50">
                                <td class="border border-gray-300 p-3">${subject}</td>
                                <td class="border border-gray-300 p-3 text-center font-semibold">${mark}</td>
                            </tr>
                        `).join('')}
                        <tr class="bg-green-100 font-bold">
                            <td class="border border-gray-300 p-3">TOTAL</td>
                            <td class="border border-gray-300 p-3 text-center">${total}</td>
                        </tr>
                    </tbody>
                </table>

                <button onclick='downloadPDF(${JSON.stringify(student)})' class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700">
                    üì• Download Result PDF
                </button>
            `;
            
            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('studentModal').classList.add('hidden');
        }

        // Download PDF
        function downloadPDF(student) {
            const subjectKey = student.class >= '9' ? `${student.class}-${student.department}` : student.class;
            const studentSubjects = subjects[subjectKey] || [];
            const total = Object.values(student.marks).reduce((sum, mark) => sum + parseInt(mark || 0), 0);
            
            const pdfHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        @page { size: A4 landscape; margin: 20mm; }
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .header { text-align: center; border-bottom: 3px solid #2563eb; padding-bottom: 15px; margin-bottom: 20px; }
        .header h1 { color: #1e40af; margin: 5px 0; font-size: 28px; }
        .header h2 { color: #4b5563; margin: 5px 0; font-size: 18px; }
        .info { display: flex; justify-content: space-between; margin: 20px 0; padding: 15px; background: #f3f4f6; border-radius: 8px; }
        .info-item { margin: 5px 0; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 2px solid #2563eb; padding: 12px; text-align: center; }
        th { background: #2563eb; color: white; font-size: 16px; }
        tr:nth-child(even) { background: #eff6ff; }
        .total { font-weight: bold; background: #dbeafe !important; font-size: 18px; }
        .footer { margin-top: 30px; text-align: center; color: #6b7280; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéì Dumuria Government Technical School & College</h1>
        <h2>Academic Result Sheet</h2>
    </div>
    
    <div class="info">
        <div>
            <div class="info-item"><strong>Student Name:</strong> ${student.name}</div>
            <div class="info-item"><strong>Roll Number:</strong> ${student.roll}</div>
        </div>
        <div>
            <div class="info-item"><strong>Class:</strong> ${student.class}</div>
            <div class="info-item"><strong>Branch:</strong> ${student.branch}</div>
            ${student.department ? `<div class="info-item"><strong>Department:</strong> ${student.department}</div>` : ''}
        </div>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Subject</th>
                <th>Marks Obtained</th>
                <th>Total Marks</th>
            </tr>
        </thead>
        <tbody>
            ${studentSubjects.map(subject => `
                <tr>
                    <td>${subject}</td>
                    <td>${student.marks[subject] || 0}</td>
                    <td>100</td>
                </tr>
            `).join('')}
            <tr class="total">
                <td>TOTAL</td>
                <td>${total}</td>
                <td>${studentSubjects.length * 100}</td>
            </tr>
        </tbody>
    </table>
    
    <div class="footer">
        <p>Generated on ${new Date().toLocaleDateString()}</p>
        <p>This is a computer-generated document</p>
    </div>
</body>
</html>`;

            const blob = new Blob([pdfHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Result_${student.name}_Class${student.class}${student.branch}.html`;
            a.click();
        }

        // Add Student
        function checkDepartment() {
            const cls = document.getElementById('newStudentClass').value;
            const deptSelect = document.getElementById('newStudentDepartment');
            
            if (cls === '9' || cls === '10') {
                deptSelect.classList.remove('hidden');
            } else {
                deptSelect.classList.add('hidden');
                deptSelect.value = '';
            }
        }

        async function addStudent() {
            const name = document.getElementById('newStudentName').value;
            const roll = document.getElementById('newStudentRoll').value;
            const cls = document.getElementById('newStudentClass').value;
            const branch = document.getElementById('newStudentBranch').value;
            const department = document.getElementById('newStudentDepartment').value;

            if (!name || !roll) {
                alert('Please fill all required fields!');
                return;
            }

            if ((cls === '9' || cls === '10') && !department) {
                alert('Please select department for Class 9/10!');
                return;
            }

            const student = {
                id: `${cls}-${branch}-${roll}-${Date.now()}`,
                name: name,
                roll: parseInt(roll),
                class: cls,
                branch: branch,
                department: department,
                marks: {}
            };

            const subjectKey = cls >= '9' ? `${cls}-${department}` : cls;
            subjects[subjectKey]?.forEach(subject => {
                student.marks[subject] = 0;
            });

            students.push(student);
            await saveStudents();
            
            document.getElementById('newStudentName').value = '';
            document.getElementById('newStudentRoll').value = '';
            alert('Student added successfully!');
        }

        // Select Class for Mark Entry
        function selectClass(cls) {
            selectedClass = cls;
            selectedSubject = '';
            
            document.querySelectorAll('[data-class]').forEach(btn => {
                if (btn.getAttribute('data-class') === cls) {
                    btn.className = 'px-6 py-3 rounded-lg transition bg-blue-600 text-white';
                } else {
                    btn.className = 'px-6 py-3 rounded-lg transition bg-gray-200 text-gray-700 hover:bg-gray-300';
                }
            });

            renderSubjects();
        }

        // Render Subjects
        function renderSubjects() {
            const container = document.getElementById('subjectButtons');
            const section = document.getElementById('subjectSelection');
            section.classList.remove('hidden');
            
            let subjectsList = [];
            
            if (selectedClass === '9' || selectedClass === '10') {
                departments.forEach(dept => {
                    const deptSubjects = subjects[`${selectedClass}-${dept}`] || [];
                    deptSubjects.forEach(subject => {
                        subjectsList.push({ key: `${dept}-${subject}`, label: `${subject} (${dept})` });
                    });
                });
            } else {
                const classSubjects = subjects[selectedClass] || [];
                classSubjects.forEach(subject => {
                    subjectsList.push({ key: subject, label: subject });
                });
            }

            container.innerHTML = subjectsList.map(s => `
                <button onclick="selectSubject('${s.key}')" 
                        data-subject="${s.key}"
                        class="px-4 py-3 rounded-lg transition bg-gray-200 text-gray-700 hover:bg-gray-300">
                    üìö ${s.label}
                </button>
            `).join('');

            document.getElementById('markEntryTable').classList.add('hidden');
        }

        // Select Subject
        function selectSubject(subject) {
            selectedSubject = subject;
            
            document.querySelectorAll('[data-subject]').forEach(btn => {
                if (btn.getAttribute('data-subject') === subject) {
                    btn.className = 'px-4 py-3 rounded-lg transition bg-green-600 text-white';
                } else {
                    btn.className = 'px-4 py-3 rounded-lg transition bg-gray-200 text-gray-700 hover:bg-gray-300';
                }
            });

            renderMarkTable();
        }

        // Render Mark Entry Table
        function renderMarkTable() {
            const container = document.getElementById('markEntryTable');
            container.classList.remove('hidden');
            
            let filteredStudents = students.filter(s => s.class === selectedClass);
            
            if (selectedSubject.includes('-')) {
                const [dept, subj] = selectedSubject.split('-');
                filteredStudents = filteredStudents.filter(s => s.department === dept);
            }

            const actualSubject = selectedSubject.includes('-') ? selectedSubject.split('-')[1] : selectedSubject;
            
            container.innerHTML = `
                <h3 class="text-xl font-bold text-gray-800 mb-4">
                    üìä Enter Marks for: ${actualSubject}
                    ${selectedSubject.includes('-') ? ` (${selectedSubject.split('-')[0]})` : ''}
                </h3>
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="bg-blue-600 text-white">
                            <th class="border border-gray-300 p-3">Student Name</th>
                            <th class="border border-gray-300 p-3">Roll</th>
                            <th class="border border-gray-300 p-3">Branch</th>
                            ${selectedSubject.includes('-') ? '<th class="border border-gray-300 p-3">Department</th>' : ''}
                            <th class="border border-gray-300 p-3">Marks (out of 100)</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredStudents.map(student => `
                            <tr class="hover:bg-gray-50">
                                <td class="border border-gray-300 p-3">${student.name}</td>
                                <td class="border border-gray-300 p-3 text-center">${student.roll}</td>
                                <td class="border border-gray-300 p-3 text-center">${student.branch}</td>
                                ${selectedSubject.includes('-') ? `<td class="border border-gray-300 p-3 text-center">${student.department}</td>` : ''}
                                <td class="border border-gray-300 p-3">
                                    <input type="number" 
                                           min="0" 
                                           max="100" 
                                           value="${student.marks[actualSubject] || 0}"
                                           onchange="updateMark('${student.id}', '${actualSubject}', this.value)"
                                           class="w-full border-2 border-gray-300 rounded px-3 py-2 text-center focus:border-blue-500 focus:outline-none">
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Update Mark
        async function updateMark(studentId, subject, mark) {
            const student = students.find(s => s.id === studentId);
            if (student) {
                student.marks[subject] = parseInt(mark) || 0;
                await saveStudents();
            }
        }

        // Start Application
        window.onload = init;
    </script>
</body>
</html>
